<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <div>Client Count: <span id="client-count">0</span></div>
    <div>Status: <span id="status">Connecting...</span></div>

    <script>
        const clientCountEl = document.getElementById('client-count');
        const statusEl = document.getElementById('status');

        const ws = new WebSocket('ws://192.168.1.139:3001/ws/');

        ws.onopen = () => {
            console.log('WebSocket connected');
            statusEl.textContent = 'Connected';
        };

        ws.onmessage = (evt) => {
            console.log('Message received:', evt.data);
            try {
                const data = JSON.parse(evt.data);
                if (data.type === 'client_count') {
                    console.log('Updating client count to:', data.count);
                    clientCountEl.textContent = data.count;
                    statusEl.textContent = 'Connected - Count updated';
                }
            } catch (e) {
                console.error('Failed to parse message:', e);
            }
        };

        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
            statusEl.textContent = 'Error';
        };

        ws.onclose = () => {
            console.log('WebSocket closed');
            statusEl.textContent = 'Closed';
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THK Mesh - Local First</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #ffd700;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.6s ease-in-out;
        }
        
        .nav-button {
            transition: all 0.3s ease;
        }
        
        .nav-button:hover {
            transform: scale(1.05);
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background-color: #10b981;
            animation: pulse 2s infinite;
        }
        
        .status-offline {
            background-color: #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .card:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-4px);
        }
    </style>
</head>
<body class="text-white font-sans">
    <!-- Navigation Bar -->
    <nav class="fixed top-0 left-0 right-0 bg-black/20 backdrop-blur-md border-b border-white/10 z-40">
        <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold">THK Mesh</div>
            <div class="flex gap-4 items-center">
                <button onclick="app.navigate('home')" class="nav-button px-4 py-2 rounded-lg hover:bg-white/10">Home</button>
                <button onclick="app.navigate('features')" class="nav-button px-4 py-2 rounded-lg hover:bg-white/10">Features</button>
                <button onclick="app.navigate('about')" class="nav-button px-4 py-2 rounded-lg hover:bg-white/10">About</button>
                <div id="auth-button-container">
                    <button onclick="app.login()" class="nav-button px-6 py-2 bg-white text-purple-600 rounded-lg font-semibold hover:bg-white/90">Login</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Status Bar -->
    <div class="fixed bottom-4 right-4 bg-black/40 backdrop-blur-md border border-white/20 rounded-lg px-4 py-2 text-sm z-40">
        <span class="status-indicator" id="status-dot"></span>
        <span id="status-text">Offline Mode</span>
    </div>

    <!-- Storage Info Panel -->
    <div class="fixed bottom-4 left-4 bg-black/40 backdrop-blur-md border border-white/20 rounded-lg px-4 py-2 text-xs z-40 max-w-xs">
        <div class="font-semibold mb-2">Local Storage</div>
        <div id="storage-info" class="opacity-75">Initializing...</div>
    </div>

    <!-- Main Content Area -->
    <div class="pt-20 pb-8">
        <!-- Home Page -->
        <div id="page-home" class="page active">
            <div class="max-w-6xl mx-auto px-6 py-16 text-center">
                <h1 class="text-6xl font-bold mb-6 fade-in">Welcome to THK Mesh</h1>
                <p class="text-2xl mb-8 opacity-90 fade-in">A local-first, decentralized collaboration platform</p>
                <p class="text-lg mb-12 opacity-75 max-w-2xl mx-auto fade-in">
                    Start exploring locally. Connect globally. All your data stays with you.
                </p>
                <div class="flex gap-4 justify-center flex-wrap fade-in">
                    <button onclick="app.navigate('features')" class="px-8 py-3 bg-white text-purple-600 rounded-lg font-semibold hover:bg-white/90 transition">Explore Features</button>
                    <button onclick="app.login()" class="px-8 py-3 border-2 border-white text-white rounded-lg font-semibold hover:bg-white/10 transition">Sign In</button>
                </div>
                
                <!-- Quick Start Section -->
                <div class="mt-16 grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
                    <div class="card fade-in">
                        <div class="text-3xl mb-3">üìù</div>
                        <h3 class="font-bold mb-2">Create Locally</h3>
                        <p class="text-sm opacity-75">Start creating documents right now, all stored locally in your browser.</p>
                    </div>
                    <div class="card fade-in">
                        <div class="text-3xl mb-3">üîó</div>
                        <h3 class="font-bold mb-2">Connect P2P</h3>
                        <p class="text-sm opacity-75">Share with others directly without a central server.</p>
                    </div>
                    <div class="card fade-in">
                        <div class="text-3xl mb-3">‚òÅÔ∏è</div>
                        <h3 class="font-bold mb-2">Sync Optional</h3>
                        <p class="text-sm opacity-75">Optionally sync to the cloud when you're ready.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features Page -->
        <div id="page-features" class="page">
            <div class="max-w-6xl mx-auto px-6 py-16">
                <h1 class="text-5xl font-bold mb-12 text-center fade-in">Features</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="card fade-in">
                        <h3 class="text-xl font-bold mb-3">üì± Local First</h3>
                        <p class="opacity-90">All data is stored locally in your browser. Work offline without any limitations.</p>
                    </div>
                    <div class="card fade-in">
                        <h3 class="text-xl font-bold mb-3">üîó P2P Ready</h3>
                        <p class="opacity-90">Connect peer-to-peer with others. No central server required for collaboration.</p>
                    </div>
                    <div class="card fade-in">
                        <h3 class="text-xl font-bold mb-3">üîê Secure</h3>
                        <p class="opacity-90">End-to-end encryption. Your data is yours. Optional cloud sync with authentication.</p>
                    </div>
                    <div class="card fade-in">
                        <h3 class="text-xl font-bold mb-3">‚ö° Fast</h3>
                        <p class="opacity-90">No network latency for local operations. Instant response times.</p>
                    </div>
                    <div class="card fade-in">
                        <h3 class="text-xl font-bold mb-3">üé® Modular</h3>
                        <p class="opacity-90">Extensible architecture. Add features as needed without bloat.</p>
                    </div>
                    <div class="card fade-in">
                        <h3 class="text-xl font-bold mb-3">üåê Open</h3>
                        <p class="opacity-90">Open source. Community-driven. Transparent development.</p>
                    </div>
                </div>
                <div class="mt-12 text-center">
                    <button onclick="app.navigate('home')" class="px-6 py-2 border-2 border-white text-white rounded-lg font-semibold hover:bg-white/10 transition">Back to Home</button>
                </div>
            </div>
        </div>

        <!-- About Page -->
        <div id="page-about" class="page">
            <div class="max-w-4xl mx-auto px-6 py-16">
                <h1 class="text-5xl font-bold mb-8 text-center fade-in">About THK Mesh</h1>
                <div class="card fade-in">
                    <h2 class="text-2xl font-bold mb-4">Our Vision</h2>
                    <p class="mb-6 opacity-90 leading-relaxed">
                        THK Mesh is built on the principle that users should have complete control over their data. We believe in a future where collaboration happens peer-to-peer, where privacy is the default, and where you're never locked into a single platform.
                    </p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Local-First Architecture</h2>
                    <p class="mb-6 opacity-90 leading-relaxed">
                        Every feature is designed to work offline first. Your browser becomes your personal knowledge container. When you're ready to collaborate, you can optionally connect to others or sync to the cloud.
                    </p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Getting Started</h2>
                    <p class="mb-4 opacity-90 leading-relaxed">
                        You can start using THK Mesh right now, completely offline. All your data is stored locally in your browser's storage. When you're ready to sync or collaborate, simply log in with your account.
                    </p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Authentication</h2>
                    <p class="mb-4 opacity-90 leading-relaxed">
                        We use Zitadel for secure authentication. When you log in, you transition from the local static environment to a server-based environment where you can sync and collaborate with others.
                    </p>
                </div>
                <div class="mt-12 text-center">
                    <button onclick="app.navigate('home')" class="px-6 py-2 border-2 border-white text-white rounded-lg font-semibold hover:bg-white/10 transition">Back to Home</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import LocalStorageManager from './js/local-storage-manager.js';
        import OAuth2Handler from './js/oauth-handler.js';

        // Initialize managers
        const storage = new LocalStorageManager({
            prefix: 'thk-mesh-',
            debug: true
        });

        const oauth = new OAuth2Handler({
            domain: 'zit.pkc.pub',
            clientId: '348213051452882951',
            redirectUri: window.location.origin + '/auth-callback-enhanced.html',
            debug: true
        });

        // Application State Manager
        window.app = {
            currentPage: 'home',
            isOnline: navigator.onLine,
            storage: storage,
            oauth: oauth,

            init() {
                storage.init();
                this.setupEventListeners();
                this.updateStatus();
                this.updateStorageInfo();
                this.checkAuthStatus();
                console.log('[App] Initialized');
            },

            setupEventListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateStatus();
                    console.log('[App] Online');
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateStatus();
                    console.log('[App] Offline');
                });

                // Update storage info periodically
                setInterval(() => this.updateStorageInfo(), 5000);
            },

            updateStatus() {
                const statusDot = document.getElementById('status-dot');
                const statusText = document.getElementById('status-text');
                
                if (this.isOnline) {
                    statusDot.className = 'status-indicator status-online';
                    statusText.textContent = 'Online';
                } else {
                    statusDot.className = 'status-indicator status-offline';
                    statusText.textContent = 'Offline Mode';
                }
            },

            updateStorageInfo() {
                const size = storage.getSize();
                const keys = storage.keys().length;
                const sizeKB = (size / 1024).toFixed(2);
                document.getElementById('storage-info').innerHTML = `
                    Items: ${keys}<br>
                    Size: ${sizeKB} KB
                `;
            },

            navigate(page) {
                // Hide all pages
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                
                // Show selected page
                const pageElement = document.getElementById(`page-${page}`);
                if (pageElement) {
                    pageElement.classList.add('active');
                    this.currentPage = page;
                    console.log(`[App] Navigated to: ${page}`);
                }
            },

            checkAuthStatus() {
                const user = storage.getUser();
                const authButton = document.getElementById('auth-button-container');
                
                if (user) {
                    authButton.innerHTML = `
                        <div class="flex gap-2 items-center">
                            <span class="text-sm opacity-75">Welcome, ${user.name || 'User'}</span>
                            <button onclick="app.logout()" class="nav-button px-6 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600">Logout</button>
                        </div>
                    `;
                    console.log('[App] User authenticated:', user.name);
                }
            },

            login() {
                // Redirect to Zitadel login
                console.log('[App] Initiating login flow...');
                oauth.redirectToLogin();
            },

            logout() {
                storage.clearUser();
                this.checkAuthStatus();
                this.navigate('home');
                console.log('[App] Logged out');
            }
        };

        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>

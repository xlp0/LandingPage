<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crash Test Component</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: monospace;
      background: #e74c3c;
      color: white;
      text-align: center;
    }
    .crash-panel {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    h3 {
      margin: 0 0 15px 0;
    }
    button {
      background: #c0392b;
      color: white;
      border: 2px solid white;
      padding: 15px 30px;
      border-radius: 4px;
      cursor: pointer;
      font-family: monospace;
      font-size: 1.1em;
      margin: 10px;
      transition: all 0.3s;
    }
    button:hover {
      background: #a93226;
      transform: scale(1.05);
    }
    .warning {
      background: rgba(255, 255, 255, 0.2);
      padding: 10px;
      border-radius: 4px;
      margin: 15px 0;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="crash-panel">
    <h3>⚠️ Crash Test Component</h3>
    <p>This component demonstrates failure isolation.</p>
    <div class="warning">
      ⚡ When this component crashes, the rest of the page continues to work normally.
    </div>
    
    <button onclick="causeInfiniteLoop()">Infinite Loop</button>
    <button onclick="throwError()">Throw Error</button>
    <button onclick="accessUndefined()">Access Undefined</button>
    <button onclick="causeMemoryLeak()">Memory Leak</button>
  </div>

  <script>
    console.log('[Crash Test Component] Loaded - Ready to fail!');

    function causeInfiniteLoop() {
      console.error('[Crash Test] Triggering infinite loop...');
      while(true) {
        // This will freeze the iframe but not the parent page
        console.log('Looping...');
      }
    }

    function throwError() {
      console.error('[Crash Test] Throwing error...');
      throw new Error('Intentional error for testing failure isolation!');
    }

    function accessUndefined() {
      console.error('[Crash Test] Accessing undefined property...');
      const obj = null;
      console.log(obj.property.that.does.not.exist);
    }

    function causeMemoryLeak() {
      console.error('[Crash Test] Creating memory leak...');
      const leakyArray = [];
      setInterval(() => {
        leakyArray.push(new Array(1000000).fill('leak'));
        console.log('Memory leak size:', leakyArray.length);
      }, 100);
    }

    // Automatically crash after 3 seconds to demonstrate isolation
    setTimeout(() => {
      console.error('[Crash Test] Auto-crashing in 3 seconds...');
      setTimeout(() => {
        throwError();
      }, 3000);
    }, 0);

    // Try to send heartbeat (will stop after crash)
    setInterval(() => {
      window.parent.postMessage({
        type: 'clm_heartbeat',
        componentId: 'crash-test',
        timestamp: Date.now()
      }, '*');
    }, 3000);
  </script>
</body>
</html>

# Fibonacci Calculator CLM
# Demonstrates recursive computation with memoization

specification:
  name: "Fibonacci Calculator"
  version: "1.0.0"
  description: "Calculate the nth Fibonacci number with memoization"
  author: "MCard Team"
  
  abstract:
    input:
      type: "number"
      description: "The position in the Fibonacci sequence (n >= 0)"
      constraints:
        - "n must be a non-negative integer"
        - "n < 100 (to prevent stack overflow)"
    
    output:
      type: "number"
      description: "The nth Fibonacci number"
      constraints:
        - "result >= 0"
        - "result is an integer"
    
    behavior:
      - "Accept a non-negative integer n"
      - "Calculate F(n) where F(0)=0, F(1)=1, F(n)=F(n-1)+F(n-2)"
      - "Use memoization to optimize repeated calculations"
      - "Return the result"

implementation:
  runtime: "typescript"
  
  concrete:
    code: |
      // Memoization cache
      const memo: Map<number, number> = new Map();
      
      function fibonacci(n: number): number {
        // Base cases
        if (n === 0) return 0;
        if (n === 1) return 1;
        
        // Check memo
        if (memo.has(n)) {
          return memo.get(n)!;
        }
        
        // Calculate and memoize
        const result = fibonacci(n - 1) + fibonacci(n - 2);
        memo.set(n, result);
        
        return result;
      }
      
      // Input validation
      const input = context.input as number;
      if (input < 0 || input >= 100 || !Number.isInteger(input)) {
        throw new Error('Input must be a non-negative integer less than 100');
      }
      
      // Execute and return result
      return fibonacci(input);
    
    dependencies:
      - name: "typescript"
        version: "^5.0.0"
    
    metadata:
      complexity: "O(n) with memoization"
      memory: "O(n) for memo cache"
      time_complexity_without_memo: "O(2^n)"

verification:
  balanced:
    tests:
      - name: "Base case F(0) = 0"
        type: "unit"
        input: 0
        expected: 0
        
      - name: "Base case F(1) = 1"
        type: "unit"
        input: 1
        expected: 1
        
      - name: "F(5) = 5"
        type: "unit"
        input: 5
        expected: 5
        
      - name: "F(10) = 55"
        type: "unit"
        input: 10
        expected: 55
        
      - name: "F(20) = 6765"
        type: "unit"
        input: 20
        expected: 6765
        
      - name: "Negative input throws error"
        type: "error"
        input: -1
        expected_error: "Input must be a non-negative integer"
        
      - name: "Large input throws error"
        type: "error"
        input: 100
        expected_error: "Input must be a non-negative integer less than 100"
    
    properties:
      - name: "Deterministic"
        description: "Same input always produces same output"
        proof: "Pure function with deterministic recursion"
        
      - name: "Total"
        description: "Always terminates for valid input"
        proof: "Bounded recursion depth (n < 100)"
        
      - name: "Correct"
        description: "Implements Fibonacci sequence correctly"
        proof: "Matches mathematical definition F(n) = F(n-1) + F(n-2)"
        
      - name: "Efficient"
        description: "Runs in linear time"
        proof: "Memoization ensures each F(i) calculated once"
    
    formal_proof:
      method: "induction"
      base_case:
        - "F(0) = 0 by definition"
        - "F(1) = 1 by definition"
      inductive_step:
        - "Assume F(k) correct for all k < n"
        - "F(n) = F(n-1) + F(n-2) by implementation"
        - "By inductive hypothesis, F(n-1) and F(n-2) are correct"
        - "Therefore, F(n) is correct"
      conclusion: "By mathematical induction, F(n) is correct for all n >= 0"

metadata:
  hash: "auto-generated"
  created: "2025-12-09"
  tags: ["example", "fibonacci", "recursion", "memoization", "typescript"]
  license: "MIT"
  performance:
    benchmarks:
      - input: 10
        time_ms: 0.1
      - input: 20
        time_ms: 0.2
      - input: 50
        time_ms: 0.5
